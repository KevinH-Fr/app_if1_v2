<%= wicked_pdf_image_tag asset_url('/images/if1main.png'), style: "width: 200px; display: block", class: "img-fluid rounded" %> 

<h1> Classement Pilotes </h1>

<% eventId = @eventId %>

<%#= @eventId %>


 <table width="600" style="margin-left:auto;margin-right:auto">
    <thead>
      <tr>
       
        <th>Date</th>
        <th>Pays</th>
        <th>Drapeau</th>
        <th>Carte</th>
        <th>Division</th>

      </tr>
    </thead>

    <tbody>

  <tr>
    <td>
          <%= Event.find(eventId).date %>
    </td>
    <td>
        <% circuitId = Event.find(eventId).circuit_id %> 
        <%= Circuit.find(circuitId).pays %>
    </td>
     <td width="60">
        <% if Circuit.find(circuitId).drapeau.present? %>
          <%= image_tag(Circuit.find(circuitId).drapeau, style: "width: 50px; display: block", class: "img-fluid rounded") %> 
        <% end %>
    </td>
      <td width="60">
        <% if Circuit.find(circuitId).carte.present? %>
          <%= image_tag(Circuit.find(circuitId).carte, style: "width: 50px; display: block", class: "img-fluid rounded") %>  
        <% end %>
    </td>
    <td>
        <% divisionId = Event.find(eventId).division_id %> 
        <%= Division.find(divisionId).numero %>
    </td>
   
  </tr>
  </tbody>
</table>


  <hr/> <br/> <br/>

  <%#= tableau data classement %>

 <% if (@eventId).blank? %>
 <% else %>
  <% eventNum = Event.find(@eventId).numero %>

    
      <table width="600" style="margin-left:auto;margin-right:auto">
        <thead class="table-dark">
          <tr>
            <th style="text-align: center;">#</th>
            <th>Pilote</th>
            <th style="text-align: center;">total</th>
          </tr>
        </thead>
       <tbody>
         
             <% if @pilotesActifDiv.blank? %>
             <% else %>
               <tr>
                <% @pilotesActifDiv.each_with_index do |pilote, i| %>
                   <td style="text-align: center;">
                    <strong>  
                      <%= (i+1) %>
                    </strong> 
                   </td>
                   <td>
                      <div class="contenant">
                        <% equipeId = pilote.ecurie %>  
                        <%= image_tag Equipe.find(equipeId).logo, style: "width: 200px; display: block", class: "img-fluid rounded" %>
                          <div class="texte_centrer">
                            <%= pilote.nom %>  
                          </div>
                      </div>
                   </td>

                     <td style="text-align: center;">
                      <% saisonId = Event.find(@eventId).saison_id %>
              
                      <strong>
                        <% cumulScore = Resultat.joins(:event).where(
                          'numero <= :numero AND saison_id = :saison_id AND pilote_id = :pilote_id AND division_id = :division_id', 
                            numero: eventNum, saison_id: saisonId, pilote_id: pilote.id, division_id: divisionId).sum(:score)  %>
                          <%= number_with_precision(cumulScore, precision: 0) %>
                      </strong>
                   </td>
                  </tr>
                <% end %>
             <% end %>
         
       </tbody>
      </table>


<br/><br/>
   PDF generation date:
<%= Time.zone.now %>


<% end %>
