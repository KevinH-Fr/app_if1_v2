
<h1>Resultats</h1>

<%# btn choix saison %>
  Choix saison |
    <% @saisons.each do |saison| %>
          <%= link_to "#{saison.nom}", 
          resultats_path(saisonId: saison.id), class:"btn btn-secondary", :method => :post %> 
    <% end %>

      <% if (@saisonId).present? %>
        <% @saisonId %>
        <hr/> 

        <%# btn choix division %>
        Choix division |
        <% @divisions.each do |division| %>
          <%= link_to "D#{division.numero}", 
              resultats_path(saisonId: @saisonId, divisionId: division.id), 
              class:"btn btn-dark", :method => :post %> 
        <% end %>

          <% if (@divisionId).present? %>
            <% @divisionId %>
            <hr/> 

            <%# btn choix event %>
            Choix event |
            <% @eventsFiltres.order(:numero).each do |event| %>
              <% if @saisonId = event.saison_id %>
                <% if @divisionId = event.division_id %>
                  <% divGp = Division.find(event.division_id).numero %>
                  <% saisonEvent = Saison.find(event.saison_id).nom %>
                  <% nomPays = Circuit.find(event.circuit_id).pays %>
                  <%= link_to "GP #{event.numero}"" - #{nomPays}", 
                      resultats_path(saisonId: @saisonId, divisionId: @divisionId, eventId: event.id), 
                      class:"btn btn-primary", :method => :post %> 
                <% end %>
              <% end %>
            <% end %>
          <% end %>
      <% end %>
  <hr/> 

  <%= link_to "Nouveau résultat", new_resultat_path, class:"btn btn-primary" %>

  <%# entete event %>
  <%# @eventId %>

 <% if (@eventId).blank? %>
 <% else %>

    <table width="600">
        <thead>
          <tr>
            <th>N°</th>
            <th>Date</th>
            <th>Pays</th>
            <th>Drapeau</th>
            <th>Carte</th>
            <th>Division</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td>
                <%= Event.find(@eventId).numero %>
            </td>
            <td>
                <%= Event.find(@eventId).date %>
            </td>
            <td>
                  <% circuitId = Event.find(@eventId).circuit_id %> 
                  <%= Circuit.find(circuitId).pays %>
            </td>
            <td width="60">
              <% if (Circuit.find(circuitId).drapeau).blank? %>
              <% else %>
                <%= image_tag(Circuit.find(circuitId).drapeau, style: "width: 50px; display: block", class: "img-fluid rounded") %> 
              <% end %>
            </td>
            <td width="60">
              <% if (Circuit.find(circuitId).carte).blank? %>
              <% else %>
                  <%= image_tag(Circuit.find(circuitId).carte, style: "width: 50px; display: block", class: "img-fluid rounded") %>  
              <% end %>
            </td>
            <td>
                <% divisionId = Event.find(@eventId).division_id %> 
                <%= Division.find(divisionId).numero %>
            </td>
          </tr>
      </tbody>
    </table>

    <hr/>
   
   <%# tableau datas %>

  <table class="table table-striped table-bordered table-hover">
    <thead class="table-dark">
      <tr>
       <%#   <th>Event</th> %>
      <%#  <th>Pays</th> %>
        <th>Pilote</th>
        <th>Ecurie</th>
        <th>Qualification</th>
        <th>Course</th>
        <th>DOTD</th>
        <th>MT</th>
        <th>Score</th>

        <th colspan="3">Actions</th>
      </tr>
    </thead>

    <tbody>
      <% @resultatsFiltres.each do |resultat| %>
            <tr>
            <%#  <td> %>
              
               <% eventID = resultat.event_id %>
                <% if eventID.nil? %>
                <% else %>
                  <% "#{Event.find(eventID).numero}" " | " "#{Event.find(eventID).circuit_id}" " | div " "#{Event.find(eventID).division}" %>
                <% end %>

               <%#  </td> %>

              <%#  <td> %>
                <% eventId = resultat.event_id %>
                <% if eventID.nil? %>
                 <% else %>
                  <% circuitId = Event.find(eventId).circuit_id %> 
                  <% Circuit.find(circuitId).pays %>
                  <% image_tag(Circuit.find(circuitId).drapeau, style: "width: 50px; display: block", class: "img-fluid rounded") %> 
                <% end %>
               
             <%#  </td> %>

              <td> 
                  <div class="contenant">
                    <% equipeId = Pilote.find(resultat.pilote_id).ecurie %>  
                    <%= image_tag Equipe.find(equipeId).logo, style: "width: 300px; display: block", class: "img-fluid rounded" %>
                      <div class="texte_centrer">
                        <%= Pilote.find(resultat.pilote_id).nom %>  
                      </div>
                  </div>
                </td> 

                 <td> <%= Equipe.find(equipeId).nom %>    </td>

              <td> <%= resultat.qualification %>  </td>
              <td> <%= resultat.course %>    </td>

                <%#= resultat.ecurie_id %>  

              <td> 
                <% resultat.dotd %>  
                <% if resultat.dotd == true %>
                  <i class="fa-solid fa-circle-check fa-xl" style="color:green"></i>
                <% else %>
                  <i class="fa-solid fa-circle-xmark fa-xl" style="color:red"></i>
                <% end %>
              </td>
              
              <td> 
                <% resultat.mt %> 
                <% if resultat.mt == true %>
                  <i class="fa-solid fa-circle-check fa-xl" style="color:green"></i>
                <% else %>
                  <i class="fa-solid fa-circle-xmark fa-xl" style="color:red"></i>
                <% end %>   
              </td>

               <%#= points %>
               <td class="fw-bold fs-xl"> <%= resultat.score.to_i %>    </td>

                <%#= actions %>
                <td width="5%">
                    <%= link_to '', resultat, class:"fa-solid fa-eye btn btn-primary" %> 
                </td>
                <td width="5%">
                  <%= button_to '', resultat, class:"fa-solid fa-trash-can btn btn-danger", method: :delete, :onclick => "return confirm('Sûr ?')" %>
                </td> 
                <td width="5%">
                    <%= link_to "", edit_resultat_path(resultat), class:"fa-regular fa-pen-to-square btn btn-warning" %> 
                </td> 

            </tr>
      <% end %>
    </tbody>
  </table>

   <br/>  <hr/>

  <%# PDF event actif %>
  <%= link_to "PDF", resultats_path(eventId: @eventId, format: :pdf), class:"btn btn-dark" %>


 

 <% end %>



